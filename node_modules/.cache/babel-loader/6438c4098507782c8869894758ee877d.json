{"ast":null,"code":"import { BLOCKED_PRICE_IMPACT_NON_EXPERT } from '../constants';\nimport { CurrencyAmount, JSBI, Percent, TokenAmount } from '@uniswap/sdk';\nimport { ALLOWED_PRICE_IMPACT_HIGH, ALLOWED_PRICE_IMPACT_LOW, ALLOWED_PRICE_IMPACT_MEDIUM } from '../constants';\nimport { Field } from '../state/swap/actions';\nimport { basisPointsToPercent } from './index'; // liquidity providers commission\n\nconst BASE_FEE = new Percent(JSBI.BigInt(25), JSBI.BigInt(10000)); // 0.25%\n\nconst ONE_HUNDRED_PERCENT = new Percent(JSBI.BigInt(10000), JSBI.BigInt(10000));\nconst INPUT_FRACTION_AFTER_BASE_FEE = ONE_HUNDRED_PERCENT.subtract(BASE_FEE); // protocol commission\n\nconst PROTOCOL_FEE = new Percent(JSBI.BigInt(5), JSBI.BigInt(10000)); // 0.05%\n\nconst INPUT_FRACTION_AFTER_PROTOCOL_FEE = ONE_HUNDRED_PERCENT.subtract(PROTOCOL_FEE); // computes price breakdown for the trade\n\nexport function computeTradePriceBreakdown(trade) {\n  const realizedProtocolFee = !trade ? undefined : ONE_HUNDRED_PERCENT.subtract(trade.route.pairs.reduce(currentFee => currentFee.multiply(INPUT_FRACTION_AFTER_PROTOCOL_FEE), ONE_HUNDRED_PERCENT)); // for each hop in our trade, take away the x*y=k price impact from 0.25% fees\n  // e.g. for 3 tokens/2 hops: 1 - ((1 - 0.025) * (1 - 0.025))\n\n  const realizedLPFee = !trade ? undefined : ONE_HUNDRED_PERCENT.subtract(trade.route.pairs.reduce(currentFee => currentFee.multiply(INPUT_FRACTION_AFTER_BASE_FEE), ONE_HUNDRED_PERCENT)); // remove lp fees from price impact\n\n  const priceImpactWithoutFeeFraction = trade && realizedLPFee ? trade.priceImpact.subtract(realizedLPFee) : undefined; // the x*y=k impact\n\n  const priceImpactWithoutFeePercent = priceImpactWithoutFeeFraction ? new Percent(priceImpactWithoutFeeFraction === null || priceImpactWithoutFeeFraction === void 0 ? void 0 : priceImpactWithoutFeeFraction.numerator, priceImpactWithoutFeeFraction === null || priceImpactWithoutFeeFraction === void 0 ? void 0 : priceImpactWithoutFeeFraction.denominator) : undefined;\n  const realizedProtocolFeeAmount = realizedProtocolFee && trade && (trade.inputAmount instanceof TokenAmount ? new TokenAmount(trade.inputAmount.token, realizedProtocolFee.multiply(trade.inputAmount.raw).quotient) : CurrencyAmount.ether(realizedProtocolFee.multiply(trade.inputAmount.raw).quotient)); // the amount of the input that accrues to LPs\n\n  const realizedLPFeeAmount = realizedLPFee && trade && (trade.inputAmount instanceof TokenAmount ? new TokenAmount(trade.inputAmount.token, realizedLPFee.multiply(trade.inputAmount.raw).quotient) : CurrencyAmount.ether(realizedLPFee.multiply(trade.inputAmount.raw).quotient));\n  return {\n    priceImpactWithoutFee: priceImpactWithoutFeePercent,\n    realizedProtocolFee: realizedProtocolFeeAmount,\n    realizedLPFee: realizedLPFeeAmount\n  };\n} // computes the minimum amount out and maximum amount in for a trade given a user specified allowed slippage in bips\n\nexport function computeSlippageAdjustedAmounts(trade, allowedSlippage) {\n  const pct = basisPointsToPercent(allowedSlippage);\n  return {\n    [Field.INPUT]: trade === null || trade === void 0 ? void 0 : trade.maximumAmountIn(pct),\n    [Field.OUTPUT]: trade === null || trade === void 0 ? void 0 : trade.minimumAmountOut(pct)\n  };\n}\nexport function warningSeverity(priceImpact) {\n  if (!(priceImpact === null || priceImpact === void 0 ? void 0 : priceImpact.lessThan(BLOCKED_PRICE_IMPACT_NON_EXPERT))) return 4;\n  if (!(priceImpact === null || priceImpact === void 0 ? void 0 : priceImpact.lessThan(ALLOWED_PRICE_IMPACT_HIGH))) return 3;\n  if (!(priceImpact === null || priceImpact === void 0 ? void 0 : priceImpact.lessThan(ALLOWED_PRICE_IMPACT_MEDIUM))) return 2;\n  if (!(priceImpact === null || priceImpact === void 0 ? void 0 : priceImpact.lessThan(ALLOWED_PRICE_IMPACT_LOW))) return 1;\n  return 0;\n}\nexport function formatExecutionPrice(trade, inverted) {\n  if (!trade) {\n    return '';\n  }\n\n  return inverted ? `${trade.executionPrice.invert().toSignificant(6)} ${trade.inputAmount.currency.symbol} / ${trade.outputAmount.currency.symbol}` : `${trade.executionPrice.toSignificant(6)} ${trade.outputAmount.currency.symbol} / ${trade.inputAmount.currency.symbol}`;\n}","map":{"version":3,"sources":["/home/titi/unifork/OrangeSwap/src/utils/prices.ts"],"names":["BLOCKED_PRICE_IMPACT_NON_EXPERT","CurrencyAmount","JSBI","Percent","TokenAmount","ALLOWED_PRICE_IMPACT_HIGH","ALLOWED_PRICE_IMPACT_LOW","ALLOWED_PRICE_IMPACT_MEDIUM","Field","basisPointsToPercent","BASE_FEE","BigInt","ONE_HUNDRED_PERCENT","INPUT_FRACTION_AFTER_BASE_FEE","subtract","PROTOCOL_FEE","INPUT_FRACTION_AFTER_PROTOCOL_FEE","computeTradePriceBreakdown","trade","realizedProtocolFee","undefined","route","pairs","reduce","currentFee","multiply","realizedLPFee","priceImpactWithoutFeeFraction","priceImpact","priceImpactWithoutFeePercent","numerator","denominator","realizedProtocolFeeAmount","inputAmount","token","raw","quotient","ether","realizedLPFeeAmount","priceImpactWithoutFee","computeSlippageAdjustedAmounts","allowedSlippage","pct","INPUT","maximumAmountIn","OUTPUT","minimumAmountOut","warningSeverity","lessThan","formatExecutionPrice","inverted","executionPrice","invert","toSignificant","currency","symbol","outputAmount"],"mappings":"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","sourcesContent":["import { BLOCKED_PRICE_IMPACT_NON_EXPERT } from '../constants'\nimport { CurrencyAmount, Fraction, JSBI, Percent, TokenAmount, Trade } from '@uniswap/sdk'\nimport { ALLOWED_PRICE_IMPACT_HIGH, ALLOWED_PRICE_IMPACT_LOW, ALLOWED_PRICE_IMPACT_MEDIUM } from '../constants'\nimport { Field } from '../state/swap/actions'\nimport { basisPointsToPercent } from './index'\n\n// liquidity providers commission\nconst BASE_FEE = new Percent(JSBI.BigInt(25), JSBI.BigInt(10000)) // 0.25%\nconst ONE_HUNDRED_PERCENT = new Percent(JSBI.BigInt(10000), JSBI.BigInt(10000))\nconst INPUT_FRACTION_AFTER_BASE_FEE = ONE_HUNDRED_PERCENT.subtract(BASE_FEE)\n// protocol commission\nconst PROTOCOL_FEE = new Percent(JSBI.BigInt(5), JSBI.BigInt(10000)) // 0.05%\nconst INPUT_FRACTION_AFTER_PROTOCOL_FEE = ONE_HUNDRED_PERCENT.subtract(PROTOCOL_FEE)\n\n// computes price breakdown for the trade\nexport function computeTradePriceBreakdown(\n  trade?: Trade\n): { priceImpactWithoutFee?: Percent; realizedLPFee?: CurrencyAmount; realizedProtocolFee?: CurrencyAmount } {\n  const realizedProtocolFee = !trade\n    ? undefined\n    : ONE_HUNDRED_PERCENT.subtract(\n        trade.route.pairs.reduce<Fraction>(\n          (currentFee: Fraction): Fraction => currentFee.multiply(INPUT_FRACTION_AFTER_PROTOCOL_FEE),\n          ONE_HUNDRED_PERCENT\n        )\n      )\n\n  // for each hop in our trade, take away the x*y=k price impact from 0.25% fees\n  // e.g. for 3 tokens/2 hops: 1 - ((1 - 0.025) * (1 - 0.025))\n  const realizedLPFee = !trade\n    ? undefined\n    : ONE_HUNDRED_PERCENT.subtract(\n        trade.route.pairs.reduce<Fraction>(\n          (currentFee: Fraction): Fraction => currentFee.multiply(INPUT_FRACTION_AFTER_BASE_FEE),\n          ONE_HUNDRED_PERCENT\n        )\n      )\n\n  // remove lp fees from price impact\n  const priceImpactWithoutFeeFraction = trade && realizedLPFee ? trade.priceImpact.subtract(realizedLPFee) : undefined\n\n  // the x*y=k impact\n  const priceImpactWithoutFeePercent = priceImpactWithoutFeeFraction\n    ? new Percent(priceImpactWithoutFeeFraction?.numerator, priceImpactWithoutFeeFraction?.denominator)\n    : undefined\n\n  const realizedProtocolFeeAmount =\n    realizedProtocolFee &&\n    trade &&\n    (trade.inputAmount instanceof TokenAmount\n      ? new TokenAmount(trade.inputAmount.token, realizedProtocolFee.multiply(trade.inputAmount.raw).quotient)\n      : CurrencyAmount.ether(realizedProtocolFee.multiply(trade.inputAmount.raw).quotient))\n\n  // the amount of the input that accrues to LPs\n  const realizedLPFeeAmount =\n    realizedLPFee &&\n    trade &&\n    (trade.inputAmount instanceof TokenAmount\n      ? new TokenAmount(trade.inputAmount.token, realizedLPFee.multiply(trade.inputAmount.raw).quotient)\n      : CurrencyAmount.ether(realizedLPFee.multiply(trade.inputAmount.raw).quotient))\n\n  return {\n    priceImpactWithoutFee: priceImpactWithoutFeePercent,\n    realizedProtocolFee: realizedProtocolFeeAmount,\n    realizedLPFee: realizedLPFeeAmount\n  }\n}\n\n// computes the minimum amount out and maximum amount in for a trade given a user specified allowed slippage in bips\nexport function computeSlippageAdjustedAmounts(\n  trade: Trade | undefined,\n  allowedSlippage: number\n): { [field in Field]?: CurrencyAmount } {\n  const pct = basisPointsToPercent(allowedSlippage)\n  return {\n    [Field.INPUT]: trade?.maximumAmountIn(pct),\n    [Field.OUTPUT]: trade?.minimumAmountOut(pct)\n  }\n}\n\nexport function warningSeverity(priceImpact: Percent | undefined): 0 | 1 | 2 | 3 | 4 {\n  if (!priceImpact?.lessThan(BLOCKED_PRICE_IMPACT_NON_EXPERT)) return 4\n  if (!priceImpact?.lessThan(ALLOWED_PRICE_IMPACT_HIGH)) return 3\n  if (!priceImpact?.lessThan(ALLOWED_PRICE_IMPACT_MEDIUM)) return 2\n  if (!priceImpact?.lessThan(ALLOWED_PRICE_IMPACT_LOW)) return 1\n  return 0\n}\n\nexport function formatExecutionPrice(trade?: Trade, inverted?: boolean): string {\n  if (!trade) {\n    return ''\n  }\n  return inverted\n    ? `${trade.executionPrice.invert().toSignificant(6)} ${trade.inputAmount.currency.symbol} / ${\n        trade.outputAmount.currency.symbol\n      }`\n    : `${trade.executionPrice.toSignificant(6)} ${trade.outputAmount.currency.symbol} / ${\n        trade.inputAmount.currency.symbol\n      }`\n}\n"]},"metadata":{},"sourceType":"module"}